{% extends 'theme.html' %}


{% block title %}
{% endblock title %}


{% block content %}
<style>
.monthBoxDiv{
    display: flex;
    justify-content: space-between;
    text-align: center;
}
.dayOfTheWeek{
    min-width: 100px;
    text-align: center;
    padding-top: 25px;
    padding-bottom: 25px;
}

.numberedDayOfTheWeek{
    border: 2px solid rgb(0, 0, 0);
    padding-top: 10px;
    padding-bottom: 90px;
    padding-left: 51px;
    padding-right: 49px;
}

li{
    list-style-type: none;
    font-size: 50px;
}

</style>

<div>
    <div class="monthBoxDiv">
        <button id="prev"><li>&#10094;</li></button>
        <div class="monthYearBoxDiv"><h2 id="currentMonth" class="text-primary"></h2><h4 id="currentYear" class="text-primary"></h4></div>
        <button id="next"><li>&#10095;</li></button>
        

    </div>
    <table id="calendarRender"></table>

    <p id="result"></p>

    <script>
        var options = { weekday: 'long' };
        var months = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
        var dayOfTheWeek = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];
        var ReverseDayOfTheWeek = ["Saturday", "Friday", "Thursday", "Wednesday", "Tuesday", "Monday", "Sunday"];
        var today = new Date();
        var currentMonth = months[today.getMonth()];
        var currentYear = today.getFullYear();
        var firstDay = new Date(today.getFullYear(), today.getMonth(), 1);
        var lastDay = new Date(today.getFullYear(), today.getMonth() + 1, 0);
        var firstDayOfMonth = firstDay.getDate();
        var lastDayOfMonth = lastDay.getDate();
        var firstDayOfWeekName = firstDay.toLocaleDateString('en-US', options);
        let index = ReverseDayOfTheWeek.indexOf(firstDay);
        let finalindex = dayOfTheWeek.indexOf(lastDay.toLocaleDateString('en-US', options));
        var nextMonth = new Date(today);
        var lastDayOfNextMonth;
        var firstDayOfNextMonth;
        var lastDayOfLastMonth;
        var firstDayOfWeekName;
        var currentMonth;
        var currentYear;

        window.onload = function() {
            var calendar = "";
            const numbersBetween = generateNumbersBetween(firstDayOfMonth, lastDayOfMonth);

            calendar = generateDayOfTheWeek(calendar);
            calendar = generateStartingDayOfWeekSpaces(calendar, index);
            calendar = generateAllDaysOfTheWeek(calendar, numbersBetween, today);
            calendar = generateEndingDayOfWeekSpace(calendar, finalindex)

            document.getElementById("calendarRender").innerHTML = calendar;
            document.getElementById("currentYear").innerHTML = currentYear;
            document.getElementById("currentMonth").innerHTML = currentMonth;
        }

        function renderCalendarNextMonth() {
            var calendar = "";
            nextMonth.setMonth(nextMonth.getMonth() + 1);
            nextMonth.setDate(1);
            lastDayOfNextMonth = new Date(nextMonth);
            lastDayOfNextMonth.setMonth(nextMonth.getMonth() + 1);
            lastDayOfNextMonth.setDate(0);
            firstDayOfNextMonth = nextMonth.getDate();
            lastDayOfLastMonth = lastDayOfNextMonth.getDate();

            firstDayOfWeekName = nextMonth.toLocaleDateString('en-US', options);
            let index = ReverseDayOfTheWeek.indexOf(nextMonth.toLocaleDateString('en-US', options));
            finalindex = dayOfTheWeek.indexOf(lastDay.toLocaleDateString('en-US', options));
            currentMonth = months[nextMonth.getMonth()];
            currentYear = nextMonth.getFullYear();
            
            const numbersBetween = generateNumbersBetween(firstDayOfNextMonth, lastDayOfLastMonth);

            calendar = generateDayOfTheWeek(calendar);

            calendar = generateStartingDayOfWeekSpaces(calendar, index);

            calendar = generateAllDaysOfTheWeek(calendar, numbersBetween, nextMonth);

            calendar = generateEndingDayOfWeekSpace(calendar, finalindex)

            document.getElementById("calendarRender").innerHTML = calendar;
            document.getElementById("currentYear").innerHTML = currentYear;
            document.getElementById("currentMonth").innerHTML = currentMonth;
            
        }

        function renderCalendarLastMonth() {
            var calendar = "";
            nextMonth.setMonth(nextMonth.getMonth() - 1);
            nextMonth.setDate(1);
            lastDayOfNextMonth = new Date(nextMonth);
            lastDayOfNextMonth.setMonth(nextMonth.getMonth() - 1);
            lastDayOfNextMonth.setDate(0);
            firstDayOfNextMonth = nextMonth.getDate();
            lastDayOfLastMonth = lastDayOfNextMonth.getDate();
            console.log(lastDayOfNextMonth)
            firstDayOfWeekName = nextMonth.toLocaleDateString('en-US', options);
            let index = ReverseDayOfTheWeek.indexOf(nextMonth.toLocaleDateString('en-US', options));
            finalindex = dayOfTheWeek.indexOf(lastDayOfNextMonth.toLocaleDateString('en-US', options));
            currentMonth = months[nextMonth.getMonth()];
            currentYear = nextMonth.getFullYear();
            
            const numbersBetween = generateNumbersBetween(firstDayOfNextMonth, lastDayOfLastMonth);

            calendar = generateDayOfTheWeek(calendar);

            calendar = generateStartingDayOfWeekSpaces(calendar, index);

            calendar = generateAllDaysOfTheWeek(calendar, numbersBetween, nextMonth);
            
            calendar = generateEndingDayOfWeekSpace(calendar, finalindex)

            document.getElementById("calendarRender").innerHTML = calendar;
            document.getElementById("currentYear").innerHTML = currentYear;
            document.getElementById("currentMonth").innerHTML = currentMonth;
            
        }

        function generateNumbersBetween(start, end) {
            if (start > end) {
                return [];
            }
            const numbers = [];
            for (let i = start; i <= end; i++) {
                numbers.push(i);
            }
            return numbers;
        }

        function generateDayOfTheWeek(calendar){
            for (let i = 0; i < 7; i++) {
                 calendar += "<th class=dayOfTheWeek>"+dayOfTheWeek[i]+"</th>";
            }
            return calendar;
        }

        function generateStartingDayOfWeekSpaces(calendar, index){
            if(index >= 1){
                calendar += "<tr>"
                for (index; index < 6; index++) { 
                    calendar += "<th class=numberedDayOfTheWeek></th>"
                }
            }
            return calendar;
        }

        function generateAllDaysOfTheWeek(calendar, numbersBetween, today){
            for (let i = 1; i < numbersBetween.length+1; i++) { //Handles the numbered of the days of the week
                if("Sunday" == new Date(today.getFullYear(), today.getMonth(), i).toLocaleDateString('en-US', options))
                    calendar += "<tr>";
                calendar += "<th class=numberedDayOfTheWeek>"+i+ "</th>";            
            }
            return calendar
        }

        function generateEndingDayOfWeekSpace(calendar, finalindex){
            console.log(finalindex);
            if(finalindex >= 1){
                for (finalindex; finalindex < 6; finalindex++) { 
                    calendar += "<th class=numberedDayOfTheWeek></th>"
                }
            }
            return calendar
        }


        document.getElementById("next").addEventListener("click", function() {
            renderCalendarNextMonth();
        });

        document.getElementById("prev").addEventListener("click", function() {
            renderCalendarLastMonth();
        });

    </script>
</div>

{% endblock content %}
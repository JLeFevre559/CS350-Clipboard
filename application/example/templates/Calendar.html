{% extends 'theme.html' %}


{% block title %}
{% endblock title %}


{% block content %}
<style>
.monthBoxDiv{
    display: flex;
    justify-content: space-between;
    text-align: center;
}
.dayOfTheWeek{
    min-width: 100px;
    text-align: center;
    padding-top: 25px;
    padding-bottom: 25px;
}

.numberedDayOfTheWeek{
    border: 2px solid rgb(0, 0, 0);
    padding-top: 10px;
    padding-bottom: 90px;
    padding-left: 51px;
    padding-right: 49px;
}

li{
    list-style-type: none;
    font-size: 50px;
}

.hidden {
    display: none;
}

</style>

<div>
    <ul class="hidden">
        {% for task in allTasks %}
            <li>{{ task.task_name }} - {{ task.due_date }}</li>
        {% endfor %}
    </ul>
    <div class="monthBoxDiv">
        <button id="prev"><li>&#10094;</li></button>
        <div class="monthYearBoxDiv"><h2 id="displayMonth" class="text-primary"></h2><h4 id="displayYear" class="text-primary"></h4></div>
        <button id="next"><li>&#10095;</li></button>
        

    </div>
    <table id="calendarRender"></table>

    <p id="result"></p>

    <script> 
        var listItems = document.getElementsByTagName('li');  // Select all <li> elements

        var textContents = [];  // Create an array to store text content

        for (var i = 0; i < listItems.length; i++) {
            var textContent = listItems[i].textContent;  // Get the text content of the element
            var textArray = textContent.split('-');  // Split the text at the "-" character
            textContents.push(textArray);
        }
        console.log(textContents);  // This array will contain ["New task with id ", " Oct. 20, 2023"]

        var options = { weekday: 'long' };
        var months = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
        var dayOfTheWeek = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];
        var ReverseDayOfTheWeek = ["Saturday", "Friday", "Thursday", "Wednesday", "Tuesday", "Monday", "Sunday"];
        var today;
        var displayMonth;
        var displayYear;
        var firstDay;
        var lastDay;
        var firstDayOfMonth;
        var lastDayOfMonth;
        var firstDayOfWeekName;
        let index;
        let finalindex;
        var lastDayOfNextMonth;
        var firstDayOfNextMonth;
        var lastDayOfLastMonth;
        var firstDayOfLastMonth;

        window.onload = function() {
            var calendar = "";
            today = new Date();
            
            firstDay = new Date(today.getFullYear(), today.getMonth(), 1);
            lastDay = new Date(today.getFullYear(), today.getMonth() + 1, 0);
            firstDayOfMonth = firstDay.getDate();
            lastDayOfMonth = lastDay.getDate();
            firstDayOfWeekName = firstDay.toLocaleDateString('en-US', options);
            index = ReverseDayOfTheWeek.indexOf(firstDay);
            finalindex = dayOfTheWeek.indexOf(lastDay.toLocaleDateString('en-US', options));

            displayMonth = months[today.getMonth()];
            displayYear = today.getFullYear();
            
            const numbersBetween = generateNumbersBetween(firstDayOfMonth, lastDayOfMonth);
                
            calendar = createCalendar(calendar,index,numbersBetween,today,finalindex);

            document.getElementById("calendarRender").innerHTML = calendar;
            document.getElementById("displayYear").innerHTML = displayYear;
            document.getElementById("displayMonth").innerHTML = displayMonth;
        }

        function renderCalendarNextMonth() {
            var calendar = "";
            today.setMonth(today.getMonth() + 1);
            today.setDate(1);
            
            firstDayOfNextMonth = new Date(today.getFullYear(), today.getMonth(), 1);
            lastDayOfNextMonth = new Date(today.getFullYear(), today.getMonth()+1, 0);         
            index = ReverseDayOfTheWeek.indexOf(firstDayOfNextMonth.toLocaleDateString('en-US', options));
            finalindex = dayOfTheWeek.indexOf(lastDayOfNextMonth.toLocaleDateString('en-US', options));
            firstDayOfNextMonth = firstDayOfNextMonth.getDate();
            lastDayOfNextMonth = lastDayOfNextMonth.getDate();
            firstDayOfWeekName = today.toLocaleDateString('en-US', options);

            displayMonth = months[today.getMonth()];
            displayYear = today.getFullYear();
            
            const numbersBetween = generateNumbersBetween(firstDayOfNextMonth, lastDayOfNextMonth);

            calendar = createCalendar(calendar,index,numbersBetween,today,finalindex);

            document.getElementById("calendarRender").innerHTML = calendar;
            document.getElementById("displayYear").innerHTML = displayYear;
            document.getElementById("displayMonth").innerHTML = displayMonth;
            
        }

        function renderCalendarLastMonth() {
            var calendar = "";
            today.setMonth(today.getMonth() - 1);
            today.setDate(1);

            firstDayOfLastMonth = new Date(today.getFullYear(), today.getMonth(), 1);
            lastDayOfLastMonth = new Date(today.getFullYear(), today.getMonth()+1, 0);         
            index = ReverseDayOfTheWeek.indexOf(firstDayOfLastMonth.toLocaleDateString('en-US', options));
            finalindex = dayOfTheWeek.indexOf(lastDayOfLastMonth.toLocaleDateString('en-US', options));
            firstDayOfLastMonth = firstDayOfLastMonth.getDate();
            lastDayOfLastMonth = lastDayOfLastMonth.getDate();
            firstDayOfWeekName = today.toLocaleDateString('en-US', options);

            displayMonth = months[today.getMonth()];
            displayYear = today.getFullYear();

            const numbersBetween = generateNumbersBetween(firstDayOfLastMonth, lastDayOfLastMonth);

            calendar = createCalendar(calendar,index,numbersBetween,today,finalindex);

            document.getElementById("calendarRender").innerHTML = calendar;
            document.getElementById("displayYear").innerHTML = displayYear;
            document.getElementById("displayMonth").innerHTML = displayMonth;
            
        }

        function createCalendar(calendar, index, numbersBetween, Month, finalindex){
            calendar = generateDayOfTheWeek(calendar);
            calendar = generateStartingDayOfWeekSpaces(calendar, index);
            calendar = generateAllDaysOfTheWeek(calendar, numbersBetween, Month);
            calendar = generateEndingDayOfWeekSpace(calendar, finalindex);
            return calendar;
        }

        function generateNumbersBetween(start, end) {
            if (start > end) {
                return [];
            }
            const numbers = [];
            for (let i = start; i <= end; i++) {
                numbers.push(i);
            }
            return numbers;
        }

        function generateDayOfTheWeek(calendar){
            for (let i = 0; i < 7; i++) {
                 calendar += "<th class=dayOfTheWeek>"+dayOfTheWeek[i]+"</th>";
            }
            return calendar;
        }

        function generateStartingDayOfWeekSpaces(calendar, index){
            if(index >= 0){
                calendar += "<tr>"
                for (index; index < 6; index++) { 
                    calendar += "<th class=numberedDayOfTheWeek></th>"
                }
            }
            return calendar;
        }

        function generateAllDaysOfTheWeek(calendar, numbersBetween, today){
            for (let i = 1; i < numbersBetween.length+1; i++) { //Handles the numbered of the days of the week
                if("Sunday" == new Date(today.getFullYear(), today.getMonth(), i).toLocaleDateString('en-US', options))
                    calendar += "<tr>";
                calendar += "<th class=numberedDayOfTheWeek>"+i+ "</th>";            
            }
            return calendar
        }

        function generateEndingDayOfWeekSpace(calendar, finalindex){
            if(finalindex >= 0){
                for (finalindex; finalindex < 6; finalindex++) { 
                    calendar += "<th class=numberedDayOfTheWeek></th>"
                }
            }
            return calendar
        }


        document.getElementById("next").addEventListener("click", function() {
            renderCalendarNextMonth();
        });

        document.getElementById("prev").addEventListener("click", function() {
            renderCalendarLastMonth();
        });

    </script>
</div>

{% endblock content %}
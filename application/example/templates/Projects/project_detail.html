<!DOCTYPE html>
{% extends 'theme.html' %}


{% block title %}
Clipboard
{% endblock title %}


{% block content %}
<html lang="en">
    <button class="project-button" href="/Project">Back to Project List</button>
    <head>
        <meta charset="UTF-8">
        <title>Project Detail</title>
    </head>
    <body>
        <h1>Project Detail</h1>
        <h2>{{ project.name }}</h2>
        <p>Description: {{ project.description }}</p>
        <!-- Add more project details here -->
        <h2>Tasklists:</h2>
        <ul>
        {% for tasklist in tasklists %}
            <div class="task-list temp">
                <h3>{{ tasklist.name }}</h2>
                <div class="task-list">
                    <h3>Status: <span id="taskListStatus" class="status-not-started">Not Started</span></h3>
                </div>
                <div class="tasks temp">
                    {% for task in tasks %}
                        {% if task.task_list == tasklist %}
                            <div class="task">
                                <p><span class="popup-trigger" data-popup-id="popup1">{{ task.task_name }}</span>:<span id="task1Status" class="status-{{ task.status }}">{{ task.status }}</span></p>
                                <button class="update-status-button" data-status="In Progress">In Progress</button>
                                <button class="update-status-button" data-status="Done">Done</button>
                            </div>
                        {% endif %}
                    {% empty %}
                        <h2>No Tasks</h2>
                    {% endfor %}
                </div>
                <button href="#" class="create-task-button project-button" data-tasklist-id="{{ tasklist.id }}">Add Task</button>
            </div>
        {% empty %}
            <h2>No Tasklists available</h3>
        {% endfor %}
        </ul>
        <button class="create-tasklist-button project-button" data-project-id="{{ project.id }}">Create new tasklist</button>
        <div class="project-buttons">
            <button class="project-button" href="{% url 'project-update' project.id%}">Edit Project</button>
            <button class="delete-button" href="{% url 'project-delete' project.id %}">Delete project</button>
        </div>
        
    </body>

  <div class="popup" id="popup1">
    <div class="popup-content">
      <ul>
        <li><p>Assigned To: <b>{{ task.assignee }}</b></p></li>
        <li><p>Task: <b>{{ task.name }}</b></p></li>
        <li>
          <p>{{ task.description }} </p>
        </li>
        <li>
          <div class="container">
            <div>
                <button class="update-status-button" data-status="In Progress">In Progress</button>
                <button class="update-status-button" data-status="Done">Done</button>
            </div>
            <h4>{{ task.due_date }} </h4>
            <button class="close-popup">Close</button>
          </div>
        </li>
      </ul>   
    </div>
  </div>

  <div class="popup" id="createTasklistPopup">
    <div class="popup-content">
        <h3>Create New Tasklist</h3>
        <form method="post" action="{% url 'create-tasklist' %}">
            {% csrf_token %}
            <!-- Include a hidden input to store the project ID -->
            <input type="hidden" name="project_id" value="">
            <label for="tasklist_name">Tasklist Name:</label>
            <input type="text" name="tasklist_name" id="tasklist_name" required>
            <button type="submit">Create</button>
            <button class="close-popup">Cancel</button>
        </form>
    </div>
  </div>

  <div class="popup" id="createTaskPopup">
    <div class="popup-content">
        <h3>Create New Task</h3>
        <form method="post" action="{% url 'create-task' %}">
            {% csrf_token %}
            <!-- Include a hidden input to store the tasklist ID -->
            <input type="hidden" name="tasklist_id" value="{{ tasklist.id }}">
            <label for="task_name">Task Name:</label>
            <input type="text" name="task_name" id="task_name" required>
            <label for="description">Description:</label>
            <textarea name="description" id="description"></textarea>
            <label for="due_date">Due Date:</label>
            <input type="date" name="due_date" id="due_date">
            <label for="priority">Priority:</label>
            <select name="priority" id="priority">
                <option value="High">High</option>
                <option value="Medium">Medium</option>
                <option value="Low">Low</option>
            </select>
            <button type="submit">Create</button>
            <button class="close-popup">Cancel</button>
        </form>
    </div>
  </div>



  <script>
    const triggers = document.querySelectorAll('.popup-trigger');
    const popups = document.querySelectorAll('.popup');
    const closeButtons = document.querySelectorAll('.close-popup');
    const updateStatusButtons = document.querySelectorAll('.update-status-button');

    // Function to show a specific popup by ID
    function showPopup(popupId) {
        const popup = document.getElementById(popupId);
        if (popup) {
            popup.style.display = 'block';
        }
    }

    // Function to hide a specific popup by ID
    function hidePopup(popupId) {
        const popup = document.getElementById(popupId);
        if (popup) {
            popup.style.display = 'none';
        }
    }

    // Add click event listeners to all trigger elements
    triggers.forEach(trigger => {
        trigger.addEventListener('click', function () {
            const popupId = this.getAttribute('data-popup-id');
            showPopup(popupId);
        });
    });

    // Add click event listeners to close buttons
    closeButtons.forEach(closeButton => {
        closeButton.addEventListener('click', function () {
            const popupId = this.closest('.popup').id;
            hidePopup(popupId);
        });
    });

    updateStatusButtons.forEach((button) => {
        button.addEventListener('click', (event) => {
            const newStatus = event.currentTarget.getAttribute('data-status');
            // Here, you can send an AJAX request to update the task status or perform any other desired action.
            // You can also update the displayed status in the popup as needed.
            const popupId = event.currentTarget.closest('.popup').id;
            const statusElement = document.getElementById(`task${popupId}Status`);
            statusElement.textContent = newStatus;
        });
    });

    document.addEventListener("DOMContentLoaded", function () {
    const createTasklistButton = document.querySelector(".create-tasklist-button");
    createTasklistButton.addEventListener("click", function () {
        const projectId = this.getAttribute("data-project-id");
        const popup = document.querySelector("#createTasklistPopup");

        // Set the project ID in the popup form (you can use a hidden input field)
        const projectIdInput = popup.querySelector("input[name='project_id']");
        projectIdInput.value = projectId;

        showPopup("createTasklistPopup");
        });
    });

    document.addEventListener("DOMContentLoaded", function () {
    const createTaskButtons = document.querySelectorAll(".create-task-button");
    createTaskButtons.forEach(function (button) {
        button.addEventListener("click", function () {
            const tasklistId = this.getAttribute("data-tasklist-id");
            const popup = document.querySelector("#createTaskPopup");

            // Set the tasklist ID in the popup form (you can use a hidden input field)
            const tasklistIdInput = popup.querySelector("input[name='tasklist_id']");
            tasklistIdInput.value = tasklistId;

            showPopup("createTaskPopup");
            });
        });
    });

    </script>

</html>
{% endblock content %}
